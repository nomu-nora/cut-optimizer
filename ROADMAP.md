# 取り数最適化システム ロードマップ

**プロジェクト**: 取り数最適化システム
**作成日**: 2025年12月4日
**最終更新**: 2025年12月16日

---

## 📍 現在地

**現在のバージョン**: v1.3.1 ✅ (リリース済み)
**次のバージョン**: v1.4 🎯 (実装中)

---

## 🎯 ビジョン

実家の板金工場で実際に使える、高精度で使いやすい取り数最適化システムを構築する。
手作業よりも効率的な配置を自動生成し、材料費とコストを削減する。

---

## 📋 バージョン一覧

### ✅ v1.0 - 基本機能の実装（完了）

**リリース日**: 2025年12月3日

**実装内容**:

- ✅ Guillotine Cut + First Fit Decreasing アルゴリズム
- ✅ 元板設定（幅、高さ、単価）
- ✅ 切断設定（カット幅、余白）
- ✅ 製品入力（名前、サイズ、個数、色）
- ✅ 配置計算
- ✅ 結果表示（パターン一覧、配置図）
- ✅ 印刷機能
- ✅ プリセット機能

**成果**:

- 基本的な配置計算が可能
- UIが完成し、使いやすい
- 型安全性が高い（TypeScript）
- テストカバレッジあり

**課題**:

- 歩留まりが低い（70-75%）
- ギロチンカットの制約で最適解が見つからない
- 手動調整が必要なレベル

**関連ドキュメント**:

- [要件定義書](./docs/torikazu_app_requirements_v1.0.md)
- [アーキテクチャ設計書](./docs/architecture.md)
- [アルゴリズム詳細仕様書](./docs/algorithm-details.md)

---

### ✅ v1.1 - Maximal Rectangles実装（完了）

**リリース日**: 2025年12月9日

**目的**:
ギロチンカットの制約を外し、現場最低限レベルを達成する。

**実装内容**:

- ✅ Maximal Rectangles アルゴリズムの実装
- ✅ 4つのヒューリスティックを自動試行
  - Best Short Side Fit
  - Best Long Side Fit
  - Best Area Fit
  - Bottom Left
- ✅ ギロチンカットとの切り替え機能
- ✅ 回転考慮の改善

**成果**:

- 歩留まり率が大幅に向上
- L字型などの複雑な空きスペースを活用
- 元板枚数の削減
- 現場で使える最低限レベルを達成

**関連ドキュメント**:

- [v1.1設計書](./docs/versions/v1.1-design.md)

---

### ✅ v1.2 - 最適化強化（完了）

**リリース日**: 2025年12月10日

**目的**:
GA・グリッド配置・余りスペース最適化による実用性向上。

**実装内容**:

- ✅ 遺伝的アルゴリズム（GA）の実装
  - 配置順序とソート戦略の進化的最適化
  - より広い解空間の探索
- ✅ グリッド配置機能
  - 同じサイズの製品を格子状に配置
  - 動的グリッド生成（空きスペースに応じた最適化）
- ✅ 最適化目標の強化
  - 歩留まり優先
  - 余りスペース優先
- ✅ 余りスペース品質評価
  - 集中度・形状・サイズの3要素で評価
- ✅ バックトラッキング機能
  - 新規元板作成前に既存元板への配置を試行

**成果**:

- 歩留まり率のさらなる向上
- 元板枚数の最適化
- 余りスペースの再活用性向上
- 実用性の大幅な向上

**関連ドキュメント**:

- [v1.2設計書](./docs/versions/v1.2-design.md)

---

### ✅ v1.2.1 - UI改善（完了）

**リリース日**: 2025年12月10日

**目的**:
使いやすさの向上と設定変更→計算→比較のワークフロー改善。

**実装内容**:

- ✅ アルゴリズム選択をアコーディオン形式に変更
- ✅ 計算実行セクションを結果エリアの上部に移動
- ✅ 計算実行ボタンを大きく、視覚的に目立つように改善
- ✅ 新規コンポーネント（AlgorithmSelector, CalculationControl）

**成果**:

- ユーザーが頻繁に使う機能へのアクセス性向上
- 設定変更→計算→比較のワークフローが自然に
- レイアウトがすっきりして操作しやすく

---

### ✅ v1.3 - 端材活用機能（完了）

**リリース日**: 2025年12月11日

**目的**:
既存の端材（余り材）を優先的に使って製品を配置し、材料費を削減する。

**実装内容**:

- ✅ 端材の手動登録（名前、サイズ、数量）
- ✅ 端材プリセット機能
- ✅ 端材に製品を配置するアルゴリズム
  - グリッド配置（1×1〜4×4の明示的テスト）
  - Maximal Rectanglesアルゴリズムとの併用
- ✅ 端材消費モード / 全体最適モードの切り替え
- ✅ 端材パターンのグループ化
- ✅ 端材配置図の表示
- ✅ サマリー表示（使用/未使用端材、削減コスト計算）

**v1.3.1での改善**:

- ✅ エッジケース修正（空端材、回転処理など）
- ✅ テストカバレッジの向上
- ✅ 型定義の整理
- ✅ コード品質の改善

**成果**:

- 既存端材の有効活用
- 元板使用枚数の削減
- 材料費の削減
- 端材の再利用率向上

**関連ドキュメント**:

- [v1.3設計書](./docs/versions/v1.3-design.md)

**今後の拡張（v1.5以降、データベース実装後）**:

- 端材生成機能（計算結果から自動生成）
- 端材の永続化（在庫管理）
- 端材使用後の残り端材計算

---

### 🎯 v1.4 - 手動調整機能（実装中）

**予定リリース日**: 2025年12月

**目的**:
自動配置結果を手動で微調整できる機能を追加し、より柔軟な配置を可能にする。

**実装内容**:

#### Phase 1: 基盤（3-4時間）

- [ ] EditableResult型定義（Copy-on-Write）
- [ ] 編集モード状態管理
- [ ] 編集モードツールバー
- [ ] 仮置き場UI

#### Phase 2: ドラッグ&ドロップコア（4-5時間）

- [ ] SVG上でのドラッグ&ドロップ実装
- [ ] Pointer Events API統合
- [ ] 座標変換ロジック
- [ ] 衝突検出・境界チェック

#### Phase 3: スマートスナップ（3-4時間）

- [ ] スナップポイント生成（角 + cutWidthオフセット）
- [ ] 空間ハッシュによる高速検索
- [ ] スナップガイド表示
- [ ] スナップON/OFF切り替え

#### Phase 4: 編集可能配置図統合（2-3時間）

- [ ] EditablePlacementDiagramコンポーネント
- [ ] 配置更新・歩留まり再計算
- [ ] ビューモード/編集モード切り替え

#### Phase 5: 仮置き場とパターン間移動（4-5時間）

- [ ] 製品クリック→仮置き場移動
- [ ] パターン切り替え（仮置き場保持）
- [ ] 仮置き場から配置
- [ ] 製品数検証
- [ ] パターン数ダイアログ（count > 1時）

#### Phase 6: 仕上げとテスト（3-4時間）

- [ ] 視覚的フィードバック改善
- [ ] キーボードショートカット
- [ ] モバイル/タッチ対応
- [ ] ユニットテスト・統合テスト

**期待される成果**:

- 自動配置の微調整が可能
- パターン間での製品移動が可能
- 製品数の整合性を維持
- 直感的な操作で配置変更
- 実務の制約に柔軟に対応

**関連ドキュメント**:

- [v1.4設計書](./docs/versions/v1.4-design.md)

**優先度**: 高

**v1.4.1以降での拡張予定**:

- 回転ハンドル
- 詳細なアンドゥ/リドゥスタック
- マルチ選択
- コピー&ペースト
- キーボード微調整（矢印キー）

---

### 💡 v1.5 - データベース・材料管理（予定）

**予定リリース日**: 2026年2月

**目的**:
データベースを導入し、端材管理・材料管理・プロジェクト保存を実現する。

**実装内容**:

#### データベース基盤

- [ ] Supabaseまたは類似のデータベース導入
- [ ] ユーザー認証・ログイン機能
- [ ] データモデル設計

#### 端材管理の永続化

- [ ] 端材の在庫管理
- [ ] 端材生成機能（計算結果から自動生成）
- [ ] 端材使用後の残り端材計算
- [ ] 端材の編集・削除機能
- [ ] 端材の最小サイズフィルタ

#### 材料管理

- [ ] 材料属性の設定（板厚、色、仕上げ）
- [ ] 製品の優先度設定（急ぎ案件など）
- [ ] 同じ材料属性でグループ化
- [ ] 優先度に応じた配置順序の調整

#### プロジェクト管理

- [ ] プロジェクトの保存・読み込み
- [ ] 履歴管理
- [ ] プロジェクト一覧・検索

**期待される成果**:

- 端材の在庫を管理できる
- 急ぎの仕事を優先配置
- 同じ材料属性の製品を同じ元板に
- プロジェクトを保存して後で編集可能

**優先度**: 高

---

### 🔮 v1.6 - 共有・エクスポート機能（予定）

**予定リリース日**: 2026年3月

**実装内容**:

- [ ] 配置結果の共有（URL）
- [ ] エクスポート機能（CSV、PDF）
- [ ] クラウドストレージ連携
- [ ] 複数ユーザーでのプロジェクト共有

**優先度**: 中

---

### 🌟 v2.0 - AI最適化（構想）

**予定リリース日**: 2026年春

**構想**:

- [ ] 機械学習による配置最適化
- [ ] 過去のデータから学習
- [ ] ユーザーの好みを学習
- [ ] 複数元板のまとめて最適化

**優先度**: 低（研究段階）

---

## 📊 開発スケジュール

```
2025年12月
├─ 12/1-3   ● v1.0リリース ✅
├─ 12/4-9   ● v1.1開発・リリース ✅
├─ 12/10    ● v1.2, v1.2.1リリース ✅
├─ 12/11    ● v1.3, v1.3.1リリース ✅
└─ 12/16-31 ○ v1.4開発（手動調整機能）

2026年1月
└─ v1.4完成・リリース

2026年2月
└─ v1.5開発（データベース・材料管理）

2026年3月
└─ v1.6開発（共有・エクスポート機能）
```

---

## 🎯 成功基準

### v1.1の成功基準

- ✅ 歩留まり率が現在より5%以上向上
- ✅ Maximal Rectanglesアルゴリズムの実装
- ✅ 全てのテストがパス

### v1.2の成功基準

- ✅ GAとグリッド配置の実装
- ✅ 最適化目標の選択機能
- ✅ 余りスペース品質評価
- ✅ 計算時間が許容範囲内（GA使用時10-20秒）

### v1.3の成功基準

- ✅ 端材の登録・管理機能
- ✅ 端材優先配置アルゴリズム
- ✅ 端材パターンの可視化
- ✅ 削減コストの計算

### v1.4の成功基準（次回目標）

- [ ] ドラッグ&ドロップによる製品移動
- [ ] スマートスナップ機能
- [ ] 仮置き場を介したパターン間移動
- [ ] 製品数の整合性検証
- [ ] 編集内容の適用・破棄

### プロジェクト全体の成功基準

- [ ] 実家で実際に使われている
- [ ] 材料費が10%以上削減
- [ ] 作業時間が短縮
- [ ] ユーザー満足度が高い

---

## 📈 メトリクス

### 測定指標

| 指標                     | v1.0 | v1.1 | v1.2    | v1.3目標 |
| ------------------------ | ---- | ---- | ------- | -------- |
| 平均歩留まり率           | 72%  | 80%+ | 85%+    | 90%+     |
| 計算時間（GAなし）       | 2秒  | 3秒  | 3秒     | 5秒      |
| 計算時間（GAあり）       | -    | -    | 10-20秒 | 10-20秒  |
| 元板枚数（テストデータ） | 5枚  | 4枚  | 3枚     | 3枚      |
| 余り材再利用率           | -    | -    | -       | 50%+     |
| ユーザー満足度           | -    | -    | -       | 80%+     |

---

## 🔧 開発・タスク管理方針

このプロジェクトは一人開発のため、シンプルな管理を重視します。

### タスク管理

- **ローカルのドキュメント**（ROADMAP.md、設計書）で計画を管理
- **Todoツール**は複数ステップがある場合のみ使用（過度な管理は避ける）
- **GitHub Issues**は使用しない
  - 理由: 手作業での移行が面倒、記録するには細かすぎる
  - 共同作業や外部からのフィードバック用に予約

### リリース管理

- **README.mdの更新履歴セクション**でバージョン管理
- リリース時に「何ができるようになったか」を明示
- コミットメッセージを明確に書く

### 原則

- **管理に手間をかけない** - 手が止まる原因を排除
- **シンプルな動線** - 複雑な管理ツールは使わない
- **実装に集中** - ドキュメントは必要最小限

---

## 🚀 次のアクション

### 完了

1. ✅ v1.0リリース（2025-12-03）
2. ✅ v1.1設計・開発・リリース（2025-12-09）
3. ✅ v1.2設計・開発・リリース（2025-12-10）
4. ✅ v1.2.1 UI改善リリース（2025-12-10）

### 今月中（12/16-12/31）

1. ✅ v1.4設計ドキュメントの作成
2. 🎯 v1.4 Phase 1-2の実装（基盤 + ドラッグ&ドロップ）
3. 実家での使用フィードバック収集

### 来月（2026年1月）

1. v1.4 Phase 3-6の実装完了
2. テストとリリース
3. v1.5の設計開始（データベース導入）

---

## 💬 フィードバック

このロードマップは開発の進捗に応じて随時更新されます。
バグ報告や機能要望は、公開後に GitHub Issues で受け付けます。

---

## 🔗 関連リンク

- [GitHub Repository](https://github.com/nomu-nora/cut-optimizer)
- [v1.0要件定義書](./docs/torikazu_app_requirements_v1.0.md)
- [v1.1設計書](./docs/versions/v1.1-design.md)
- [v1.2設計書](./docs/versions/v1.2-design.md)
- [v1.3設計書](./docs/versions/v1.3-design.md)
- [v1.4設計書](./docs/versions/v1.4-design.md)
- [アーキテクチャ設計書](./docs/architecture.md)

---

**最終更新**: 2025年12月16日
**次回更新予定**: v1.4実装完了時
